<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="info">
 
 	<!-- 장소정보 전체 갯수 구하는 sql문 -->
 	<select id="selectPlaceCount" resultType="int">
 		select count(*) from place
 	</select>
 	
 	<!-- 장소정보 전체 검색 sql문 -->
 	<select id="selectPlace" resultType="placeDTO">
 		select * from place
 	</select>
 	
 	<!-- 해당 장소정보의 갯수를 검색 sql문  -->
 	<select id="selectPlaceInfoCount" parameterType="int" resultType="int">
 		select count(*) from place
 		<where>
 			<if test="index_num > 0">index_num = #{value}</if>
 		</where>
 	</select>
 	
 	<!-- 해당 장소정보를 검색 sql문  -->
 	<select id="selectPlaceInfo" parameterType="int" resultType="placeDTO">
 		select * from place
 		<where>
 			<if test="index_num > 0">index_num = #{value}</if>
 		</where>
 	</select>
 	
 	<!-- 해당 장소정보의 전체 댓글수 검색 sql문 -->
 	<select id="selectPlaceReplyCount" parameterType="int" resultType="int">
 		select count(*) from place_reply pr, member m
 		<where>
 			pr.writer = m.index_num 
 			<if test="place > 0">and pr.place = #{value}</if>
 		</where>
 		order by pr.index_num desc
 	</select>
 	
 	<!-- 해당 장소정보의 전체 댓글 검색 sql문 -->
 	<select id="selectPlaceReply" parameterType="int" resultType="place_replyDTO">
 		select pr.index_num, pr.place, m.nick, pr.content, pr.reg_date
 		from place_reply pr, member m
 		<where>
 			pr.writer = m.index_num
 			<if test="place > 0">and pr.place = #{value}</if>
 		</where>
 		order by pr.index_num desc
 	</select>
 	
 	<!-- 해당 장소정보의 댓글 등록 sql문 -->
 	<insert id="insertPlaceReply" parameterType="place_replyDTO">
 		insert into place_reply(index_num, place, writer, content, reg_date)
 		values(place_reply_seq.nextval, #{place}, #{writer}, #{content}, sysdate)
 	</insert>
 	
 	<!-- 해당 장소 상세정보 클릭시 조회수 증가 sql문 -->
 	<update id="updateViews" parameterType="int">
 		update place set views = views+1
		<where> 
			<if test="index_num > 0"> index_num = #{index_num}</if>
		</where>
 	</update>
 	
 	<!-- 키워드 입력하여 장소 검색결과 갯수 sql문 -->
 	<select id="selectKeywordCount" parameterType="String" resultType="int">
 		select count(*) from place
		where name like '%' || #{value} || '%'
 	</select>
 	
 	<!-- 키워드 입력하여 장소 검색결과 sql문 -->
 	<select id="selectKeywordPlaceNum" parameterType="String" resultType="placeDTO">
 		select * from place
		where name like '%' || #{value} || '%'
 	</select>
 
 </mapper> 